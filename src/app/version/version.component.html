<div class="loader" *ngIf="!isLoaded"></div>
<div class="container-fluid" *ngIf="isLoaded">
  <ng-container class="card">
    <app-version-selector class="text-center"
      [versions]="versions"
      (versionSelected)="changeCurrentVersion($event)"
    ></app-version-selector>
<!--    <span class="text-center title">Общая информация</span>-->
    <p class="text-center text-muted">{{current_version.description}}</p>
    <div class="loader" *ngIf="!isInfoLoaded"></div>
    <div class="main-card card" *ngIf="isInfoLoaded">
      <div class="card-header main-card-header">
        <span class="title">Общая информация</span>
      </div>
      <div class="info-cards align-self-center justify-content-center row" *ngIf="current_version">
        <div class="card col-5 flex-row flex-wrap justify-content-center ">
          <div class="card-header" [inlineSVG]="'./assets/icons/rub.svg'"  [setSVGAttributes]="{'width' : '36px', 'height' : '36px'}"></div>
          <div class="card-block">
            <span class="card-title">ФИНАНСИРОВАНИЕ</span>
            <h4 class="card-text"> {{ current_version.generalInfo.totalFinanceBud}}/{{current_version.generalInfo.totalFinanceNoBud}}млн</h4>
          </div>
        </div>
        <div class="card col-3 flex-row flex-wrap ">
          <div class="card-header" [inlineSVG]="'./assets/icons/event.svg'" [setSVGAttributes]="{'width' : '36px', 'height' : '36px'}"></div>
          <div class="card-block">
            <span class="card-title">МЕРОПРИЯТИЯ</span>
            <h4 class="card-text">{{current_version.generalInfo.totalWorks}}/{{current_version.generalInfo.totalCompletedWorks}} </h4>
          </div>
        </div>
        <div class="card col-3 flex-row flex-wrap ">
          <div class="card-header" [inlineSVG]="'./assets/icons/launch.svg'" [setSVGAttributes]="{'width' : '36px', 'height' : '36px'}"></div>
          <div class="card-block">
            <span class="card-title">ЗАПУСКИ</span>
            <p class="card-text h4"> {{current_version.generalInfo.totalPlannedLaunches}}/{{current_version.generalInfo.totalCompletedLaunches}}</p>
          </div>
        </div>
      </div>
      <div class="card table-card">
        <div class="card-body">
          <div class="text-center card-title">
            <span>Цели и задачи</span>
          </div>
          <dx-tree-list class="table"
            [dataSource]="current_version.goalsObjectives"
            keyExpr="id"
            parentIdExpr="parentId"
            [allowColumnResizing]="true"
            [allowColumnReordering]="true"
            [showRowLines]="true"
            [showBorders]="true"
            [expandedRowKeys]="[1]">
            <dxi-column dataField="name" caption="Наименование"></dxi-column>
            <dxi-column dataField="type" caption="Тип"></dxi-column>
            <dxo-search-panel [placeholder]="'Поиск'" [visible]="true"></dxo-search-panel>
          </dx-tree-list>
        </div>
      </div>
      <div class="card table-card">
        <div class="card-body chart-card">
          <dx-chart
            class="chart"
            id="chart"
            title="Финансовые лимиты"
            [dataSource]="this.current_version.financeLimits ">
            <dxi-value-axis position="right">
              <dxo-title text="миллионы"></dxo-title>
            </dxi-value-axis>
            <dxo-series-template
              nameField="name">
            </dxo-series-template>
            <dxo-common-series-settings
              [color]="'#0366d6'"
              argumentField="argument"
              valueField="value"
              type="bar">
            </dxo-common-series-settings>
            <dxo-tooltip
              [enabled]="true"
              >
            </dxo-tooltip>
          </dx-chart>
        </div>
      </div>
      <div class="card table-card">
        <div class="card-body chart-card">
          <dx-chart
            class="chart"
            id="finance-chart"
            title="Финансирование Бюджет/Внебюджет"
            [dataSource]="current_version.finances">
            <dxi-value-axis position="right">
              <dxo-title text="миллионы"></dxo-title>
            </dxi-value-axis>
            <dxo-series-template
              nameField="name">
            </dxo-series-template>
            <dxo-common-series-settings
              argumentField="argument"
              valueField="value"
              type="stackedBar">
            </dxo-common-series-settings>
            <dxo-tooltip
              [enabled]="true"
              >
            </dxo-tooltip>
          </dx-chart>
        </div>
      </div>
      <div class="card table-card">
        <div class="card-body chart-card">
          <dx-chart
            class="chart"
            id="finance-by-chapter-chart"
            title="Финансирование по подразделам раздела НИОКР"
            palette="dark-violet"
            [dataSource]="financesBySubChapter">
            <dxi-value-axis position="right">
              <dxo-title text="миллионы"></dxo-title>
            </dxi-value-axis>
            <dxo-series-template
              nameField="name">
            </dxo-series-template>
            <dxo-common-series-settings
              argumentField="argument"
              valueField="value"
              type="bar">
            </dxo-common-series-settings>
            <dxo-tooltip
              [enabled]="true"
              >
            </dxo-tooltip>
          </dx-chart>
        </div>
      </div>


<!--      <div class="card table-card">-->
<!--        <div class="card-body">-->
<!--          <span class="card-title">Финансирование</span>-->
<!--          <dx-pivot-grid class="table" id="finance"-->
<!--                         [allowSortingBySummary]="true"-->
<!--                         [allowSorting]="true"-->
<!--                         [allowFiltering]="true"-->
<!--                         [allowExpandAll]="true"-->
<!--                         [height]="440"-->
<!--                         [showBorders]="true"-->
<!--                         [dataSource]="finance_data_source">-->
<!--            <dxo-field-chooser-->
<!--              [allowSearch]="true"-->
<!--              [enabled]="true">-->
<!--            </dxo-field-chooser>-->
<!--          </dx-pivot-grid>-->
<!--        </div>-->
<!--      </div>-->
    </div>

  </ng-container>
</div>


